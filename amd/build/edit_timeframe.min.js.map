{"version":3,"sources":["../src/edit_timeframe.js"],"names":["define","$","ModalFactory","Templates","str","url","get_timestamp","startmin","last","selectedIndex","starthour","startday","startmonth","startyear","endmin","endhour","endday","endmonth","endyear","startdate","Date","enddate","getTime","ready","readyState","status","responseText","require","notification","get_string","done","s","alert","initialize","startdates","enddates","i","dummy","element","length","on","e","clickedLink","currentTarget","create","type","types","SAVE_CANCEL","title","body","render","then","modal","root","getRoot","saveid","URL","prop","searchParams","get","times","settime","checked","category","xhttp","XMLHttpRequest","onreadystatechange","relativeUrl","open","send","elementNo","split","starttime","endtime","document","getElementById","innerHTML","show","timesetter","now","init"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/templates', 'core/str', 'core/url'], function ($, ModalFactory, Templates, str, url) {\n\n    var get_timestamp = function () {\n        var startmin = $('[name=minute_start]').last()[0].selectedIndex;\n        var starthour = $('[name=hour_start]').last()[0].selectedIndex;\n        var startday = $('[name=day_start]').last()[0].selectedIndex;\n        var startmonth = $('[name=month_start]').last()[0].selectedIndex;\n        var startyear = $('[name=year_start]').last()[0].selectedIndex + 2000;\n\n        var endmin = $('[name=minute_end]').last()[0].selectedIndex;\n        var endhour = $('[name=hour_end]').last()[0].selectedIndex;\n        var endday = $('[name=day_end]').last()[0].selectedIndex;\n        var endmonth = $('[name=month_end]').last()[0].selectedIndex;\n        var endyear = $('[name=year_end]').last()[0].selectedIndex + 2000;\n        var startdate = new Date(startyear, startmonth, startday + 1, starthour, startmin);\n        var enddate = new Date(endyear, endmonth, endday + 1, endhour, endmin);\n        return {\n            'starttime': startdate.getTime() / 1000,\n            'endtime': enddate.getTime() / 1000\n        };\n    };\n\n    var ready = function () {\n        if (this.readyState === 4 && this.status >= 200 && !(this.responseText == \"\")) {\n            require(['core/notification', ], function (notification) {\n                str.get_string('save_failure', 'block_evasys_sync').done(function (s) {\n                    notification.alert('Error', s, 'OK');\n                });\n            });\n        }\n    };\n\n    var initialize = function (startdates, enddates) {\n        var i = 0;\n        str.get_string('edit_time', 'block_evasys_sync').done(function (s) {\n            var dummy  = true;\n            while (dummy) {\n                var element = $(\"#timeediturl_\" + i);\n                if (element.length <= 0) {\n                    dummy = false;\n                    break;\n                }\n                element.on('click', function (e) {\n                    var clickedLink = $(e.currentTarget);\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: s,\n                        body: Templates.render('block_evasys_sync/edittime', {}),\n                    })\n                        .then(function (modal) {\n                            var root = modal.getRoot();\n                            root.on('modal-save-cancel:save', function () {\n                                var saveid = new URL(clickedLink.prop('href')).searchParams.get(\"id\");\n                                var times = {};\n                                var settime = $('[name=use_standardtime]').last()[0].checked;\n                                if (settime) {\n                                    times = get_timestamp();\n                                }\n                                times.category = saveid;\n                                var xhttp = new XMLHttpRequest();\n                                xhttp.onreadystatechange = ready;\n                                var s = url.relativeUrl(\"/blocks/evasys_sync/alterstandardtime.php\", times, true);\n                                xhttp.open('GET', s);\n                                xhttp.send();\n                                var elementNo = clickedLink.prop('id').split(\"_\")[1];\n                                startdates[elementNo] = times.starttime;\n                                enddates[elementNo] = times.endtime;\n                                if (settime) {\n                                    str.get_string('time_set', 'block_evasys_sync').done(function (s) {\n                                        document.getElementById('timehint_' + elementNo).innerHTML = s;\n                                    });\n                                } else {\n                                    document.getElementById('timehint_' + elementNo).innerHTML = \"\";\n                                }\n                            });\n                            modal.show();\n                            require(['block_evasys_sync/initialize'], function(timesetter) {\n                                var elementNo = clickedLink.prop('id').split(\"_\")[1];\n                                if (startdates[elementNo] === null || startdates[elementNo] === undefined) {\n                                    startdates[elementNo] = Date.now() / 1000;\n                                    enddates[elementNo] = Date.now() / 1000;\n                                } else {\n                                    $('[name=use_standardtime]').last()[0].checked = true;\n                                }\n                                timesetter.init(startdates[elementNo], enddates[elementNo]);\n                            });\n                        });\n                });\n                i++;\n            }\n        });\n    };\n    return {\n        initialize: initialize,\n    };\n});"],"file":"edit_timeframe.min.js"}