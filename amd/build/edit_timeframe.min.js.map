{"version":3,"file":"edit_timeframe.min.js","sources":["../src/edit_timeframe.js"],"sourcesContent":["define(['jquery', 'core/modal_factory', 'core/templates', 'core/str', 'core/url'], function ($, ModalFactory, Templates, str, url) {\n\n    var get_timestamp = function () {\n        var startmin = $('[name=minute_start]').last()[0].selectedIndex;\n        var starthour = $('[name=hour_start]').last()[0].selectedIndex;\n        var startday = $('[name=day_start]').last()[0].selectedIndex;\n        var startmonth = $('[name=month_start]').last()[0].selectedIndex;\n        var startyear = $('[name=year_start]').last()[0].selectedIndex + 2000;\n\n        var endmin = $('[name=minute_end]').last()[0].selectedIndex;\n        var endhour = $('[name=hour_end]').last()[0].selectedIndex;\n        var endday = $('[name=day_end]').last()[0].selectedIndex;\n        var endmonth = $('[name=month_end]').last()[0].selectedIndex;\n        var endyear = $('[name=year_end]').last()[0].selectedIndex + 2000;\n        var startdate = new Date(startyear, startmonth, startday + 1, starthour, startmin);\n        var enddate = new Date(endyear, endmonth, endday + 1, endhour, endmin);\n        return {\n            'starttime': startdate.getTime() / 1000,\n            'endtime': enddate.getTime() / 1000\n        };\n    };\n\n    var ready = function () {\n        if (this.readyState === 4 && this.status >= 200 && !(this.responseText == \"\")) {\n            require(['core/notification', ], function (notification) {\n                str.get_string('save_failure', 'block_evasys_sync').done(function (s) {\n                    notification.alert('Error', s, 'OK');\n                });\n            });\n        }\n    };\n\n    var initialize = function (startdates, enddates) {\n        var i = 0;\n        str.get_string('edit_time', 'block_evasys_sync').done(function (s) {\n            var dummy  = true;\n            while (dummy) {\n                var element = $(\"#timeediturl_\" + i);\n                if (element.length <= 0) {\n                    dummy = false;\n                    break;\n                }\n                element.on('click', function (e) {\n                    var clickedLink = $(e.currentTarget);\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: s,\n                        body: Templates.render('block_evasys_sync/edittime', {}),\n                    })\n                        .then(function (modal) {\n                            var root = modal.getRoot();\n                            root.on('modal-save-cancel:save', function () {\n                                var saveid = new URL(clickedLink.prop('href')).searchParams.get(\"id\");\n                                var times = {};\n                                var settime = $('[name=use_standardtime]').last()[0].checked;\n                                if (settime) {\n                                    times = get_timestamp();\n                                }\n                                times.category = saveid;\n                                var xhttp = new XMLHttpRequest();\n                                xhttp.onreadystatechange = ready;\n                                var s = url.relativeUrl(\"/blocks/evasys_sync/alterstandardtime.php\", times, true);\n                                xhttp.open('GET', s);\n                                xhttp.send();\n                                var elementNo = clickedLink.prop('id').split(\"_\")[1];\n                                startdates[elementNo] = times.starttime;\n                                enddates[elementNo] = times.endtime;\n                                if (settime) {\n                                    str.get_string('time_set', 'block_evasys_sync').done(function (s) {\n                                        document.getElementById('timehint_' + elementNo).innerHTML = s;\n                                    });\n                                } else {\n                                    document.getElementById('timehint_' + elementNo).innerHTML = \"\";\n                                }\n                            });\n                            modal.show();\n                            require(['block_evasys_sync/initialize'], function(timesetter) {\n                                var elementNo = clickedLink.prop('id').split(\"_\")[1];\n                                if (startdates[elementNo] === null || startdates[elementNo] === undefined) {\n                                    startdates[elementNo] = Date.now() / 1000;\n                                    enddates[elementNo] = Date.now() / 1000;\n                                } else {\n                                    $('[name=use_standardtime]').last()[0].checked = true;\n                                }\n                                timesetter.init(startdates[elementNo], enddates[elementNo]);\n                            });\n                        });\n                });\n                i++;\n            }\n        });\n    };\n    return {\n        initialize: initialize,\n    };\n});"],"names":["define","$","ModalFactory","Templates","str","url","ready","this","readyState","status","responseText","require","notification","get_string","done","s","alert","initialize","startdates","enddates","i","dummy","element","length","on","e","clickedLink","currentTarget","create","type","types","SAVE_CANCEL","title","body","render","then","modal","getRoot","startmin","starthour","startday","startmonth","startyear","endmin","endhour","endday","endmonth","endyear","startdate","enddate","saveid","URL","prop","searchParams","get","times","settime","last","checked","selectedIndex","Date","getTime","category","xhttp","XMLHttpRequest","onreadystatechange","relativeUrl","open","send","elementNo","split","starttime","endtime","document","getElementById","innerHTML","show","timesetter","undefined","now","init"],"mappings":"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"}