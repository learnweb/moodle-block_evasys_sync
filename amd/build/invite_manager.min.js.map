{"version":3,"file":"invite_manager.min.js","sources":["../src/invite_manager.js"],"sourcesContent":["define(['core/str', 'core/notification', 'core/url', 'jquery'], function (str, notification, url, $) {\n    var updateParticipants = function(participants) {\n        var participantFields = $('.block_evasys_participants');\n        participantFields.each(function() {\n            this.innerHTML = participants;\n        });\n    };\n\n    var submitInvitation = function (dates) {\n        var xhttp = new XMLHttpRequest();\n        xhttp.onreadystatechange = function () {\n            if (this.readyState === 4 && this.status === 200) {\n                var responseParts = this.responseText.split('#');\n                if (responseParts[0] === \"success inviting\") {\n                    updateParticipants(responseParts[1]);\n                    str.get_strings([\n                        {'key': 'title_success', component: 'block_evasys_sync'},\n                        {'key': 'content_success_invite', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                        ]).done(function (s) {\n                            notification.alert(s[0], s[1], s[2]);\n                        });\n                } else if (responseParts[0] === \"success\") {\n                    str.get_strings([\n                        {'key': 'title_success', component: 'block_evasys_sync'},\n                        {'key': 'content_success_direct', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"Start after end\") {\n                    str.get_strings([\n                        {'key': 'title_date_invalid', component: 'block_evasys_sync'},\n                        {'key': 'content_start_after_end', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"End in the past\") {\n                    str.get_strings([\n                        {'key': 'title_date_invalid', component: 'block_evasys_sync'},\n                        {'key': 'content_invalidend', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"wrong mode\") {\n                    str.get_strings([\n                        {'key': 'title_wrong_mode', component: 'block_evasys_sync'},\n                        {'key': 'content_wrong_mode', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else {\n                    str.get_string('send_error', 'block_evasys_sync').done(function (s) {\n                        notification.alert(\"Error\", s, \"OK\");\n                    });\n                }\n            } else if (this.readyState === 4) {\n                str.get_string('send_error', 'block_evasys_sync').done(function (s) {\n                    notification.alert(\"Error\", s, \"OK\");\n                });\n            }\n            if (this.readyState === 4) {\n                $('#evasys_block_form').find(':input[type=submit]').prop('disabled', false);\n            }\n        };\n        var s = url.relativeUrl(\"/blocks/evasys_sync/invite.php\", dates, true);\n        xhttp.open(\"GET\", s);\n        xhttp.send();\n    };\n\n    var init = function () {\n        // Overwrite standard submit function.\n        $('#evasys_block_form').submit(function (e) {\n            // We don't wanna get redirected.\n            e.preventDefault();\n            // Also we don't want someone to send another ajax because the first one didn't compvare yet.\n            $('#evasyssubmitbutton').prop('disabled', true);\n            // Call to invite.php with data being passed to it.\n            var data = {};\n            $('#evasys_block_form').serializeArray().forEach(function (param) {\n                data[param['name']] = param['value'];\n            });\n            submitInvitation(data);\n        });\n\n        if ($('#direct_invite').length > 0) {\n            str.get_strings([\n                {'key': 'planorstartevaluation', component: 'block_evasys_sync'},\n                {'key': 'startevaluationnow', component: 'block_evasys_sync'}\n            ]).done(function (s) {\n                $('#direct_invite').change(function() {\n                    if(this.checked) {\n                        $('#evasyssubmitbutton').val(s[1]);\n                    } else {\n                        $('#evasyssubmitbutton').val(s[0]);\n                    }\n                });\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","str","notification","url","$","submitInvitation","dates","xhttp","XMLHttpRequest","onreadystatechange","this","readyState","status","responseParts","responseText","split","participants","each","innerHTML","get_strings","component","done","s","alert","get_string","find","prop","relativeUrl","open","send","init","submit","e","preventDefault","data","serializeArray","forEach","param","length","change","checked","val"],"mappings":"AAAAA,0CAAO,CAAC,WAAY,oBAAqB,WAAY,WAAW,SAAUC,IAAKC,aAAcC,IAAKC,OAQ1FC,iBAAmB,SAAUC,WACzBC,MAAQ,IAAIC,eAChBD,MAAME,mBAAqB,cACC,IAApBC,KAAKC,YAAoC,MAAhBD,KAAKE,OAAgB,KAC1CC,cAAgBH,KAAKI,aAAaC,MAAM,KACnB,qBAArBF,cAAc,IAZIG,aAaCH,cAAc,GAZrBT,EAAE,8BACRa,MAAK,gBACdC,UAAYF,gBAWTf,IAAIkB,YAAY,CACZ,KAAQ,gBAAiBC,UAAW,qBACpC,KAAQ,yBAA0BA,UAAW,qBAC7C,KAAQ,QACLC,MAAK,SAAUC,GACdpB,aAAaqB,MAAMD,EAAE,GAAIA,EAAE,GAAIA,EAAE,QAEb,YAArBT,cAAc,GACrBZ,IAAIkB,YAAY,CACZ,KAAQ,gBAAiBC,UAAW,qBACpC,KAAQ,yBAA0BA,UAAW,qBAC7C,KAAQ,QACTC,MAAK,SAAUC,GACdpB,aAAaqB,MAAMD,EAAE,GAAIA,EAAE,GAAIA,EAAE,OAET,oBAArBT,cAAc,GACrBZ,IAAIkB,YAAY,CACZ,KAAQ,qBAAsBC,UAAW,qBACzC,KAAQ,0BAA2BA,UAAW,qBAC9C,KAAQ,QACTC,MAAK,SAAUC,GACdpB,aAAaqB,MAAMD,EAAE,GAAIA,EAAE,GAAIA,EAAE,OAET,oBAArBT,cAAc,GACrBZ,IAAIkB,YAAY,CACZ,KAAQ,qBAAsBC,UAAW,qBACzC,KAAQ,qBAAsBA,UAAW,qBACzC,KAAQ,QACTC,MAAK,SAAUC,GACdpB,aAAaqB,MAAMD,EAAE,GAAIA,EAAE,GAAIA,EAAE,OAET,eAArBT,cAAc,GACrBZ,IAAIkB,YAAY,CACZ,KAAQ,mBAAoBC,UAAW,qBACvC,KAAQ,qBAAsBA,UAAW,qBACzC,KAAQ,QACTC,MAAK,SAAUC,GACdpB,aAAaqB,MAAMD,EAAE,GAAIA,EAAE,GAAIA,EAAE,OAGrCrB,IAAIuB,WAAW,aAAc,qBAAqBH,MAAK,SAAUC,GAC7DpB,aAAaqB,MAAM,QAASD,EAAG,cAGZ,IAApBZ,KAAKC,YACZV,IAAIuB,WAAW,aAAc,qBAAqBH,MAAK,SAAUC,GAC7DpB,aAAaqB,MAAM,QAASD,EAAG,SA5DtB,IAASN,aA+DF,IAApBN,KAAKC,YACLP,EAAE,sBAAsBqB,KAAK,uBAAuBC,KAAK,YAAY,QAGzEJ,EAAInB,IAAIwB,YAAY,iCAAkCrB,OAAO,GACjEC,MAAMqB,KAAK,MAAON,GAClBf,MAAMsB,cAkCH,CACHC,KAhCO,WAEP1B,EAAE,sBAAsB2B,QAAO,SAAUC,GAErCA,EAAEC,iBAEF7B,EAAE,uBAAuBsB,KAAK,YAAY,OAEtCQ,KAAO,GACX9B,EAAE,sBAAsB+B,iBAAiBC,SAAQ,SAAUC,OACvDH,KAAKG,MAAK,MAAYA,MAAK,SAE/BhC,iBAAiB6B,SAGjB9B,EAAE,kBAAkBkC,OAAS,GAC7BrC,IAAIkB,YAAY,CACZ,KAAQ,wBAAyBC,UAAW,qBAC5C,KAAQ,qBAAsBA,UAAW,uBAC1CC,MAAK,SAAUC,GACdlB,EAAE,kBAAkBmC,QAAO,WACpB7B,KAAK8B,QACJpC,EAAE,uBAAuBqC,IAAInB,EAAE,IAE/BlB,EAAE,uBAAuBqC,IAAInB,EAAE"}