{"version":3,"sources":["../src/invite_manager.js"],"names":["define","str","notification","url","$","updateParticipants","participants","participantFields","each","innerHTML","submitInvitation","dates","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","responseParts","responseText","split","get_strings","component","done","s","alert","get_string","find","prop","relativeUrl","open","send","init","submit","e","preventDefault","data","serializeArray","forEach","param","length","change","checked","val"],"mappings":"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","sourcesContent":["define(['core/str', 'core/notification', 'core/url', 'jquery'], function (str, notification, url, $) {\n    var updateParticipants = function(participants) {\n        var participantFields = $('.block_evasys_participants');\n        participantFields.each(function() {\n            this.innerHTML = participants;\n        });\n    };\n\n    var submitInvitation = function (dates) {\n        var xhttp = new XMLHttpRequest();\n        xhttp.onreadystatechange = function () {\n            if (this.readyState === 4 && this.status === 200) {\n                var responseParts = this.responseText.split('#');\n                if (responseParts[0] === \"success inviting\") {\n                    updateParticipants(responseParts[1]);\n                    str.get_strings([\n                        {'key': 'title_success', component: 'block_evasys_sync'},\n                        {'key': 'content_success_invite', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                        ]).done(function (s) {\n                            notification.alert(s[0], s[1], s[2]);\n                        });\n                } else if (responseParts[0] === \"success\") {\n                    str.get_strings([\n                        {'key': 'title_success', component: 'block_evasys_sync'},\n                        {'key': 'content_success_direct', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"Start after end\") {\n                    str.get_strings([\n                        {'key': 'title_date_invalid', component: 'block_evasys_sync'},\n                        {'key': 'content_start_after_end', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"End in the past\") {\n                    str.get_strings([\n                        {'key': 'title_date_invalid', component: 'block_evasys_sync'},\n                        {'key': 'content_invalidend', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else if (responseParts[0] === \"wrong mode\") {\n                    str.get_strings([\n                        {'key': 'title_wrong_mode', component: 'block_evasys_sync'},\n                        {'key': 'content_wrong_mode', component: 'block_evasys_sync'},\n                        {'key': 'ok'}\n                    ]).done(function (s) {\n                        notification.alert(s[0], s[1], s[2]);\n                    });\n                } else {\n                    str.get_string('send_error', 'block_evasys_sync').done(function (s) {\n                        notification.alert(\"Error\", s, \"OK\");\n                    });\n                }\n            } else if (this.readyState === 4) {\n                str.get_string('send_error', 'block_evasys_sync').done(function (s) {\n                    notification.alert(\"Error\", s, \"OK\");\n                });\n            }\n            if (this.readyState === 4) {\n                $('#evasys_block_form').find(':input[type=submit]').prop('disabled', false);\n            }\n        };\n        var s = url.relativeUrl(\"/blocks/evasys_sync/invite.php\", dates, true);\n        xhttp.open(\"GET\", s);\n        xhttp.send();\n    };\n\n    var init = function () {\n        // Overwrite standard submit function.\n        $('#evasys_block_form').submit(function (e) {\n            // We don't wanna get redirected.\n            e.preventDefault();\n            // Also we don't want someone to send another ajax because the first one didn't compvare yet.\n            $('#evasyssubmitbutton').prop('disabled', true);\n            // Call to invite.php with data being passed to it.\n            var data = {};\n            $('#evasys_block_form').serializeArray().forEach(function (param) {\n                data[param['name']] = param['value'];\n            });\n            submitInvitation(data);\n        });\n\n        if ($('#direct_invite').length > 0) {\n            str.get_strings([\n                {'key': 'planorstartevaluation', component: 'block_evasys_sync'},\n                {'key': 'startevaluationnow', component: 'block_evasys_sync'}\n            ]).done(function (s) {\n                $('#direct_invite').change(function() {\n                    if(this.checked) {\n                        $('#evasyssubmitbutton').val(s[1]);\n                    } else {\n                        $('#evasyssubmitbutton').val(s[0]);\n                    }\n                });\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"invite_manager.min.js"}